<div class="audio-section" [class.playing]="isPlaying" [class.beat-pulse]="beatDetected">
  <!-- Enhanced Title with Dancing Colors -->
  <div class="audio-title-container">
    <ion-text class="dancing-title">
      <h3>ðŸŽµ {{ audioTitle }}</h3>
    </ion-text>
  </div>
  
  <!-- Custom Audio Player -->
  <div class="custom-audio-player"
       [class.visualizer-active]="isPlaying">
       
    <!-- Audio Visualization -->
    <div class="audio-visualization" [class.active]="isPlaying">
      <div class="visualization-container">
        <!-- Circular Visualizer -->
        <canvas 
          #circularCanvas 
          class="circular-visualizer"
          width="200" 
          height="200">
        </canvas>
        
        <!-- Spectrum Visualizer -->
        <canvas 
          #spectrumCanvas 
          class="spectrum-visualizer"
          width="300" 
          height="80">
        </canvas>
        
        <!-- Central Play Button -->
        <div class="central-play-button" 
             [class.beat-detected]="beatDetected"
             (click)="playAudio()">
          <ion-icon 
            [name]="isPlaying ? 'pause' : 'play'">
          </ion-icon>
        </div>
      </div>
    </div>
    <!-- Enhanced Progress Bar with Color Waves -->
    <div class="audio-progress-container" 
         [class.rainbow-glow]="isPlaying"
         (click)="onProgressBarClick($event)"
         (touchstart)="onTouchStart($event)"
         (touchmove)="onTouchMove($event)"
         (touchend)="onTouchEnd($event)"
         (mousedown)="onMouseDown($event)"
         (mousemove)="onMouseMove($event)"
         (mouseup)="onMouseUp($event)"
         (mouseleave)="onMouseUp($event)">
      <div class="audio-progress-bar">
        <div class="audio-progress-fill" 
             [class.beat-glow]="beatDetected"
             [style.width.%]="progress"></div>
        <div class="audio-progress-thumb" 
             [class.dancing]="isPlaying"
             [style.left.%]="progress"></div>
      </div>
    </div>
    
    <!-- Enhanced Audio Controls -->
    <div class="audio-controls" [class.rainbow-mode]="isPlaying">
      <div class="audio-time">
        <span class="current-time">{{ formatTime(currentTime) }}</span>
        <span class="duration">{{ formatTime(duration) }}</span>
      </div>
      
      <div class="audio-actions">
        <!-- Main Play/Pause Button - Hidden since we have central button -->
        <!-- Additional Controls Row -->
        <div class="audio-controls-row">
          <!-- Loop Control -->
          @if (enableLoop) {
            <ion-button 
              fill="outline" 
              [color]="isLooping ? 'warning' : 'medium'"
              [class.rainbow-border]="isPlaying && isLooping"
              (click)="toggleLoop()"
              [class.active]="isLooping">
              <ion-icon name="repeat" slot="start"></ion-icon>
              {{ isLooping ? 'Repeat On' : 'Repeat Off' }}
            </ion-button>
          }
          
          <!-- Playback Speed Control -->
          @if (enableSpeedControl) {
            <ion-button 
              fill="outline" 
              color="primary"
              [class.rainbow-border]="isPlaying"
              (click)="changePlaybackSpeed()">
              <ion-icon name="speedometer" slot="start"></ion-icon>
              {{ playbackSpeed }}x
            </ion-button>
          }
          
          <!-- Download Button -->
          @if (enableDownload) {
            <ion-button 
              fill="outline" 
              color="success"
              [class.rainbow-border]="isPlaying"
              (click)="downloadAudio()">
              <ion-icon name="download" slot="start"></ion-icon>
              Download
            </ion-button>
          }

          <!-- Share Button -->
          @if (enableShare) {
            <ion-button 
              fill="outline" 
              color="tertiary"
              [class.rainbow-border]="isPlaying"
              (click)="shareAudio()">
              <ion-icon name="share" slot="start"></ion-icon>
              Share
            </ion-button>
          }
        </div>
      </div>
    </div>
  </div>
</div>
