<app-technique-header 
  title="Anuloma PƒÅ·π≠ha" 
  sanskrit="‡§Ö‡§®‡•Å‡§≤‡•ã‡§Æ‡§™‡§æ‡§†" 
  emoji="üïâÔ∏è"
  color="tertiary" 
  [translucent]="true" 
  [showMenuButton]="true">
</app-technique-header>

<ion-content [fullscreen]="true" class="anuloma-content">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Anuloma PƒÅ·π≠ha</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-icon">‚û°Ô∏è</div>
    <h1 class="hero-title">Anuloma PƒÅ·π≠ha</h1>
    <h2 class="hero-sanskrit">‡§Ö‡§®‡•Å‡§≤‡•ã‡§Æ ‡§™‡§æ‡§†</h2>
    <p class="hero-description">
      Forward Sequential Recitation Method - Build memory gradually by mastering verses line by line in natural forward order, creating rhythm and flow
    </p>
    <div class="prestige-badge">
      <ion-icon name="arrow-forward-outline"></ion-icon>
      <span>Progressive Foundation</span>
    </div>
  </div>

  <!-- Introduction Section -->
  <div class="introduction-section">
    <div class="intro-header">
      <ion-icon name="book-outline"></ion-icon>
      <h2>Understanding Anuloma PƒÅ·π≠ha</h2>
    </div>
    
    <div class="intro-content">
      <div class="definition-card">
        <h3>
          <ion-icon name="library-outline"></ion-icon>
          Definition & Etymology
        </h3>
        <p><strong>"Anuloma"</strong> = in forward order, <strong>"pƒÅ·π≠ha"</strong> = recitation</p>
        <p>The ≈õloka is recited line by line (pƒÅda by pƒÅda) in forward sequential order, building memory step-by-step through systematic progression.</p>
      </div>

      <div class="purpose-card">
        <h3>
          <ion-icon name="trophy-outline"></ion-icon>
          Purpose & Benefits
        </h3>
        <ul>
          <li>Builds memory gradually without overwhelming the learner</li>
          <li>Strengthens continuity, rhythm, and flow in recitation</li>
          <li>Creates systematic progression from simple to complex</li>
          <li>Develops confidence through step-by-step mastery</li>
          <li>Perfect bridge between line practice and full ≈õloka recitation</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Method Explanation Section -->
  <div class="method-section">
    <h2>üîÑ How Anuloma PƒÅ·π≠ha Works</h2>
    
    <div class="method-example">
      <div class="sloka-header">
        <h3>Example: Bhagavad Gƒ´tƒÅ 2.47</h3>
        <div class="full-sloka">
          <div class="sloka-devanagari">
            ‡§ï‡§∞‡•ç‡§Æ‡§£‡•ç‡§Ø‡•á‡§µ‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡§∏‡•ç‡§§‡•á ‡§Æ‡§æ ‡§´‡§≤‡•á‡§∑‡•Å ‡§ï‡§¶‡§æ‡§ö‡§®‡•§<br>
            ‡§Æ‡§æ ‡§ï‡§∞‡•ç‡§Æ‡§´‡§≤‡§π‡•á‡§§‡•Å‡§∞‡•ç‡§≠‡•Ç‡§∞‡•ç‡§Æ‡§æ ‡§§‡•á ‡§∏‡§ô‡•ç‡§ó‡•ã‡§Ω‡§∏‡•ç‡§§‡•ç‡§µ‡§ï‡§∞‡•ç‡§Æ‡§£‡§ø‡••
          </div>
          <div class="sloka-meaning">
            "You have a right to perform your prescribed duty, but not to the fruits of action. Never consider yourself the cause of the results, and never be attached to not doing your duty."
          </div>
        </div>
      </div>

      <div class="progressive-steps">
        <div class="step-container">
          <div class="step-number">1</div>
          <div class="step-content">
            <h4>First: Master Line 1</h4>
            <div class="line-example">
              <div class="line-text">‡§ï‡§∞‡•ç‡§Æ‡§£‡•ç‡§Ø‡•á‡§µ‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡§∏‡•ç‡§§‡•á ‡§Æ‡§æ ‡§´‡§≤‡•á‡§∑‡•Å ‡§ï‡§¶‡§æ‡§ö‡§®‡•§</div>
              <div class="line-roman">karma·πáy evƒÅdhikƒÅras te mƒÅ phale·π£u kadƒÅcana</div>
            </div>
            <p>Practice this line until perfectly memorized with proper pronunciation</p>
          </div>
        </div>

        <div class="step-arrow">
          <ion-icon name="arrow-down-outline"></ion-icon>
        </div>

        <div class="step-container">
          <div class="step-number">2</div>
          <div class="step-content">
            <h4>Then: Add Line 2 & Combine</h4>
            <div class="line-example combined">
              <div class="line-text">
                ‡§ï‡§∞‡•ç‡§Æ‡§£‡•ç‡§Ø‡•á‡§µ‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡§∏‡•ç‡§§‡•á ‡§Æ‡§æ ‡§´‡§≤‡•á‡§∑‡•Å ‡§ï‡§¶‡§æ‡§ö‡§®‡•§<br>
                <span class="new-line">‡§Æ‡§æ ‡§ï‡§∞‡•ç‡§Æ‡§´‡§≤‡§π‡•á‡§§‡•Å‡§∞‡•ç‡§≠‡•Ç‡§∞‡•ç‡§Æ‡§æ ‡§§‡•á ‡§∏‡§ô‡•ç‡§ó‡•ã‡§Ω‡§∏‡•ç‡§§‡•ç‡§µ‡§ï‡§∞‡•ç‡§Æ‡§£‡§ø‡••</span>
              </div>
            </div>
            <p>Now recite both lines together in flowing sequence</p>
          </div>
        </div>

        <div class="step-arrow">
          <ion-icon name="arrow-down-outline"></ion-icon>
        </div>

        <div class="step-container">
          <div class="step-number">3</div>
          <div class="step-content">
            <h4>Finally: Complete ≈öloka Mastery</h4>
            <div class="mastery-badge">
              <ion-icon name="trophy-outline" color="warning"></ion-icon>
              <span>Full ≈öloka with Perfect Rhythm & Flow</span>
            </div>
            <p>Achieve seamless recitation of the entire verse</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Learning Stages Section -->
  <div class="stages-section">
    <h2>üìö Learning Stages in Anuloma PƒÅ·π≠ha</h2>
    
    <div class="stages-grid">
      <div class="stage-card">
        <div class="stage-icon">
          <ion-icon name="play-circle-outline" color="primary"></ion-icon>
        </div>
        <h3>Stage 1: Listen</h3>
        <p>Hear each line with clear pronunciation and proper meter</p>
        <div class="stage-features">
          <span>üîä Audio playback</span>
          <span>‚è© Speed control</span>
        </div>
      </div>

      <div class="stage-card">
        <div class="stage-icon">
          <ion-icon name="mic-outline" color="danger"></ion-icon>
        </div>
        <h3>Stage 2: Practice</h3>
        <p>Repeat the line after listening, record your attempts</p>
        <div class="stage-features">
          <span>üé§ Voice recording</span>
          <span>üìä Accuracy feedback</span>
        </div>
      </div>

      <div class="stage-card">
        <div class="stage-icon">
          <ion-icon name="checkmark-circle-outline" color="success"></ion-icon>
        </div>
        <h3>Stage 3: Master</h3>
        <p>Achieve fluent recitation to unlock the next line</p>
        <div class="stage-features">
          <span>‚úÖ Line mastery</span>
          <span>üèÜ Progress badges</span>
        </div>
      </div>

      <div class="stage-card">
        <div class="stage-icon">
          <ion-icon name="layers-outline" color="warning"></ion-icon>
        </div>
        <h3>Stage 4: Combine</h3>
        <p>Recite mastered lines together in flowing sequence</p>
        <div class="stage-features">
          <span>üîó Line combination</span>
          <span>üéµ Rhythm building</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Practice Section -->
  <div class="practice-section">
    <h2>üéØ Choose Your ≈öloka for Anuloma Practice</h2>
    
    <div class="sloka-selection">
      <div class="sloka-cards">
        <ion-card class="sloka-card" (click)="selectSloka(1)">
          <ion-card-header>
            <ion-card-title>Gƒ´tƒÅ 2.47</ion-card-title>
            <ion-card-subtitle>‡§ï‡§∞‡•ç‡§Æ‡§£‡•ç‡§Ø‡•á‡§µ‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞‡§∏‡•ç‡§§‡•á</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <div class="sloka-info">
              <div class="lines-count">
                <ion-icon name="list-outline"></ion-icon>
                <span>2 Lines to Master</span>
              </div>
              <div class="difficulty-level">
                <ion-icon name="star-outline" color="warning"></ion-icon>
                <span>Beginner Friendly</span>
              </div>
            </div>
            <p>Famous verse about action without attachment - perfect for learning forward progression</p>
          </ion-card-content>
        </ion-card>

        <ion-card class="sloka-card" (click)="selectSloka(2)">
          <ion-card-header>
            <ion-card-title>Gƒ´tƒÅ 4.7-8</ion-card-title>
            <ion-card-subtitle>‡§Ø‡§¶‡§æ ‡§Ø‡§¶‡§æ ‡§π‡§ø ‡§ß‡§∞‡•ç‡§Æ‡§∏‡•ç‡§Ø</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <div class="sloka-info">
              <div class="lines-count">
                <ion-icon name="list-outline"></ion-icon>
                <span>4 Lines to Master</span>
              </div>
              <div class="difficulty-level">
                <ion-icon name="star-outline" color="warning"></ion-icon>
                <ion-icon name="star-outline" color="warning"></ion-icon>
                <span>Intermediate</span>
              </div>
            </div>
            <p>Krishna's divine promise about His appearance - excellent for building rhythm and flow</p>
          </ion-card-content>
        </ion-card>

        <ion-card class="sloka-card" (click)="selectSloka(3)">
          <ion-card-header>
            <ion-card-title>Gƒ´tƒÅ 18.65</ion-card-title>
            <ion-card-subtitle>‡§Æ‡§®‡•ç‡§Æ‡§®‡§æ ‡§≠‡§µ ‡§Æ‡§¶‡•ç‡§≠‡§ï‡•ç‡§§‡•ã</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <div class="sloka-info">
              <div class="lines-count">
                <ion-icon name="list-outline"></ion-icon>
                <span>2 Lines to Master</span>
              </div>
              <div class="difficulty-level">
                <ion-icon name="star-outline" color="warning"></ion-icon>
                <span>Devotional</span>
              </div>
            </div>
            <p>Beautiful devotional instruction - practice sequential surrender and devotion</p>
          </ion-card-content>
        </ion-card>
      </div>
    </div>
  </div>

  <!-- Training Interface -->
  <div class="training-interface" *ngIf="selectedSloka">
    <div class="training-header">
      <h3>üéì Progressive Training: {{selectedSloka.title}}</h3>
      <div class="overall-progress">
        <div class="progress-info">
          <span>Line {{currentLineIndex + 1}} of {{selectedSloka.lines.length}}</span>
          <span class="progress-percentage">{{overallProgress}}% Complete</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="overallProgress"></div>
        </div>
      </div>
    </div>

    <!-- Current Line Focus -->
    <div class="current-line-section">
      <div class="line-header">
        <h4>Currently Learning: Line {{currentLineIndex + 1}}</h4>
        <div class="line-status" [ngClass]="getLineStatusClass()">
          <ion-icon [name]="getLineStatusIcon()"></ion-icon>
          <span>{{getLineStatusText()}}</span>
        </div>
      </div>

      <div class="line-display">
        <div class="line-content">
          <div class="line-devanagari">{{currentLine.devanagari}}</div>
          <div class="line-roman">{{currentLine.roman}}</div>
          <div class="line-meaning">{{currentLine.meaning}}</div>
        </div>

        <div class="line-controls">
          <div class="audio-controls">
            <ion-button (click)="playLineSlow()" color="primary">
              <ion-icon name="play-circle-outline" slot="start"></ion-icon>
              Play Slow
            </ion-button>
            <ion-button (click)="playLineNormal()" color="secondary">
              <ion-icon name="musical-notes-outline" slot="start"></ion-icon>
              Play Normal
            </ion-button>
          </div>

          <div class="practice-controls">
            <ion-button 
              (click)="startRecording()" 
              [disabled]="isRecording || !hasHeardLine"
              color="danger"
            >
              <ion-icon name="mic-outline" slot="start"></ion-icon>
              {{isRecording ? 'Recording...' : 'Record Practice'}}
            </ion-button>
            
            <div class="practice-feedback" *ngIf="practiceeFeedback">
              <div class="feedback-message" [ngClass]="feedbackClass">
                {{practiceeFeedback}}
              </div>
            </div>
          </div>

          <div class="mastery-controls" *ngIf="currentLine.practiced >= 3">
            <ion-button 
              (click)="markLineMastered()" 
              [disabled]="currentLine.mastered"
              color="success"
            >
              <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
              {{currentLine.mastered ? 'Line Mastered!' : 'Mark as Mastered'}}
            </ion-button>
          </div>
        </div>
      </div>
    </div>

    <!-- Previous Lines Display (Mastered) -->
    <div class="mastered-lines-section" *ngIf="hasMasteredLines()">
      <h4>üìã Previously Mastered Lines</h4>
      <div class="mastered-lines-list">
        <div 
          *ngFor="let line of getMasteredLines(); let i = index" 
          class="mastered-line-item"
        >
          <div class="line-number">{{i + 1}}</div>
          <div class="line-preview">
            <div class="line-text">{{line.devanagari}}</div>
            <div class="line-roman">{{line.roman}}</div>
          </div>
          <div class="mastery-badge">
            <ion-icon name="checkmark-circle" color="success"></ion-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Combined Practice Section -->
    <div class="combined-practice-section" *ngIf="hasMasteredLines() && currentLine.mastered">
      <h4>üîó Combined Practice: Lines 1-{{currentLineIndex + 1}}</h4>
      
      <div class="combined-display">
        <div class="combined-content">
          <div *ngFor="let line of getCombinedLines(); let i = index" class="combined-line">
            <span class="line-number-small">{{i + 1}}</span>
            <span class="combined-devanagari">{{line.devanagari}}</span>
          </div>
        </div>

        <div class="combined-controls">
          <ion-button (click)="playCombinedLines()" color="tertiary">
            <ion-icon name="play-forward-outline" slot="start"></ion-icon>
            Play Combined (1-{{currentLineIndex + 1}})
          </ion-button>
          
          <ion-button 
            (click)="recordCombined()" 
            [disabled]="isRecordingCombined"
            color="warning"
          >
            <ion-icon name="mic-outline" slot="start"></ion-icon>
            {{isRecordingCombined ? 'Recording Combined...' : 'Record Combined'}}
          </ion-button>
        </div>

        <div class="combined-feedback" *ngIf="combinedFeedback">
          <div class="feedback-message" [ngClass]="combinedFeedbackClass">
            {{combinedFeedback}}
          </div>
        </div>
      </div>
    </div>

    <!-- Line Progress Overview -->
    <div class="lines-overview">
      <h4>üìä Line-by-Line Progress</h4>
      <div class="lines-grid">
        <div 
          *ngFor="let line of selectedSloka.lines; let i = index"
          class="line-progress-item"
          [ngClass]="{
            'completed': line.mastered,
            'current': i === currentLineIndex,
            'locked': i > currentLineIndex && !line.mastered,
            'available': i <= currentLineIndex
          }"
          (click)="goToLine(i)"
        >
          <div class="line-number">{{i + 1}}</div>
          <div class="line-preview">{{line.roman.substring(0, 25)}}...</div>
          <div class="line-status-indicator">
            <ion-icon 
              *ngIf="line.mastered" 
              name="checkmark-circle" 
              color="success"
            ></ion-icon>
            <ion-icon 
              *ngIf="i === currentLineIndex && !line.mastered" 
              name="radio-button-on" 
              color="tertiary"
            ></ion-icon>
            <ion-icon 
              *ngIf="i > currentLineIndex && !line.mastered" 
              name="lock-closed-outline" 
              color="medium"
            ></ion-icon>
            <span *ngIf="i < currentLineIndex && !line.mastered" class="practice-count">
              {{line.practiced}}/3
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Controls -->
    <div class="navigation-controls">
      <ion-button 
        (click)="previousLine()" 
        [disabled]="currentLineIndex === 0" 
        fill="outline"
      >
        <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
        Previous Line
      </ion-button>
      
      <ion-button 
        (click)="nextLine()" 
        [disabled]="!canProceedToNext()" 
        fill="outline"
      >
        Next Line
        <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
      </ion-button>
    </div>

    <!-- Completion Section -->
    <div class="completion-section" *ngIf="isSlokaCompleted()">
      <div class="completion-card">
        <div class="completion-animation">
          <ion-icon name="trophy" color="warning"></ion-icon>
          <div class="celebration-text">üéâ ≈öloka Mastered! üéâ</div>
        </div>
        <h3>Congratulations!</h3>
        <p>You've successfully learned all lines in forward sequence. You can now recite the entire ≈õloka with perfect flow and rhythm!</p>
        <div class="completion-actions">
          <ion-button (click)="practiceFullSloka()" color="success">
            <ion-icon name="play-circle-outline" slot="start"></ion-icon>
            Practice Full ≈öloka
          </ion-button>
          <ion-button (click)="claimMasteryBadge()" color="warning">
            <ion-icon name="medal-outline" slot="start"></ion-icon>
            Claim Mastery Badge
          </ion-button>
          <ion-button (click)="selectNextSloka()" fill="outline">
            <ion-icon name="arrow-forward-outline" slot="start"></ion-icon>
            Try Next ≈öloka
          </ion-button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tips Section -->
  <div class="tips-section">
    <h2>üí° Anuloma PƒÅ·π≠ha Mastery Tips</h2>
    <div class="tips-grid">
      <div class="tip-card">
        <ion-icon name="time-outline" color="primary"></ion-icon>
        <h4>Take Your Time</h4>
        <p>Don't rush to the next line. Master each line completely before proceeding</p>
      </div>
      <div class="tip-card">
        <ion-icon name="repeat-outline" color="secondary"></ion-icon>
        <h4>Repetition is Key</h4>
        <p>Practice each line multiple times until it flows naturally</p>
      </div>
      <div class="tip-card">
        <ion-icon name="musical-notes-outline" color="tertiary"></ion-icon>
        <h4>Feel the Rhythm</h4>
        <p>Pay attention to the natural meter and rhythm of Sanskrit verses</p>
      </div>
      <div class="tip-card">
        <ion-icon name="layers-outline" color="warning"></ion-icon>
        <h4>Build Gradually</h4>
        <p>Once lines are mastered, practice them in combinations for flow</p>
      </div>
    </div>
  </div>

</ion-content>
