<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/bhagavad-gita"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ chapterData?.title || 'Chapter Details' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="chapter-detail-bg">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ chapterData?.title }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-container">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <ion-text color="medium">
        <p>Loading chapter details...</p>
      </ion-text>
    </div>
  }

  <!-- Error State -->
  @else if (error) {
    <div class="error-container">
      <ion-text color="danger">
        <h3>‚ö†Ô∏è Error</h3>
        <p>{{ error }}</p>
      </ion-text>
      <ion-button fill="outline" (click)="goBack()">
        <ion-icon name="arrow-back" slot="start"></ion-icon>
        Go Back
      </ion-button>
    </div>
  }

  <!-- Chapter Content -->
  @else if (chapterData) {
    

    <div class="chapter-detail-container">
      <!-- Chapter Image -->
      <div class="chapter-image-section">
        <img [src]="chapterData.img" [alt]="chapterData.title" class="chapter-image" />
        <div class="chapter-overlay">
          <ion-text color="light">
            <h1 class="chapter-title">{{ chapterData.title }}</h1>
            <p class="chapter-number">Chapter {{ chapterData.category }}</p>
          </ion-text>
        </div>
      </div>

      <!-- Chapter Content -->
      <div class="chapter-content-section">
        <!-- Audio Section -->
        <div class="audio-section">
          <ion-text color="primary">
            <h3>üéµ Listen to Chapter</h3>
          </ion-text>
          
          <!-- Custom Audio Player -->
          <div class="custom-audio-player">
            <!-- Progress Bar -->
            <div class="audio-progress-container" (click)="onProgressBarClick($event)">
              <div class="audio-progress-bar">
                <div class="audio-progress-fill" [style.width.%]="progress"></div>
              </div>
            </div>
            
            <!-- Audio Controls -->
            <div class="audio-controls">
              <div class="audio-time">
                <span class="current-time">{{ formatTime(currentTime) }}</span>
                <span class="duration">{{ formatTime(duration) }}</span>
              </div>
              
              <div class="audio-actions">
                <ion-button 
                  expand="block" 
                  fill="solid" 
                  [color]="isPlaying ? 'warning' : 'secondary'"
                  (click)="playAudio(chapterData.audioData.audioSrc)">
                  <ion-icon [name]="isPlaying ? 'pause' : 'play'" slot="start"></ion-icon>
                  {{ isPlaying ? 'Pause Chapter' : 'Play Chapter' }}
                </ion-button>
                
                <!-- Additional Controls Row -->
                <div class="audio-controls-row">
                  <!-- Playback Speed Control -->
                  <ion-button 
                    fill="outline" 
                    color="primary"
                    (click)="changePlaybackSpeed()">
                    <ion-icon name="speedometer" slot="start"></ion-icon>
                    {{ playbackSpeed }}x
                  </ion-button>
                  
                  <!-- Download Button -->
                  <ion-button 
                    fill="outline" 
                    color="success"
                    (click)="downloadAudio()">
                    <ion-icon name="download" slot="start"></ion-icon>
                    Download
                  </ion-button>

                  <!-- Share Button -->
                  <ion-button 
                    fill="outline" 
                    color="tertiary"
                    (click)="shareChapter()">
                    <ion-icon name="share" slot="start"></ion-icon>
                    Share
                  </ion-button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Description Section -->
        <div class="description-section">
            <ion-text color="primary">
              <h3>üìñ Chapter Description</h3>
            </ion-text>
            <div class="description-content">
              <ion-text color="dark">
                <div [innerHTML]="chapterData.desc"></div>
              </ion-text>
            </div>
          </div>

          <!-- Chapter Info -->
          <div class="chapter-info-section">
            <ion-text color="primary">
              <h3>‚ÑπÔ∏è Chapter Information</h3>
            </ion-text>
            <div class="info-grid">
              <div class="info-item">
                <ion-text color="medium">
                  <strong>Chapter Number:</strong>
                </ion-text>
                <ion-text color="dark">
                  <p>{{ chapterData.category }}</p>
                </ion-text>
              </div>
              <div class="info-item">
                <ion-text color="medium">
                  <strong>Author:</strong>
                </ion-text>
                <ion-text color="dark">
                  <p>{{ chapterData.audioData.auther }}</p>
                </ion-text>
              </div>
              <div class="info-item">
                <ion-text color="medium">
                  <strong>Rating:</strong>
                </ion-text>
                <ion-text color="dark">
                  <p>‚≠ê {{ chapterData.rating }}/5</p>
                </ion-text>
              </div>
            </div>
          </div>

          <!-- Learning Instructions -->
          <div class="instructions-section">
            <ion-text color="primary">
              <h3>üìö Learning Guide</h3>
            </ion-text>
            <ion-text color="dark">
              <p>
                Listen to this chapter audio to understand the deeper meanings and context. 
                The Tamil narration will help you grasp the spiritual teachings of the Bhagavad Gita 
                in your native language.
              </p>
              <ul>
                <li>Listen to the full chapter audio</li>
                <li>Reflect on the teachings</li>
                <li>Practice memorization of key verses</li>
                <li>Apply the learnings in daily life</li>
              </ul>
            </ion-text>
          </div>
        </div>
      </div>
    }
  </ion-content>
