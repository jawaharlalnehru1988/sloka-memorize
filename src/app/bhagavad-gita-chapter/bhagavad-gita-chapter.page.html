<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/bhagavad-gita"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ chapterData?.title || 'Chapter Details' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="chapter-detail-bg">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ chapterData?.title }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-container">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <ion-text color="medium">
        <p>Loading chapter details...</p>
      </ion-text>
    </div>
  }

  <!-- Error State -->
  @else if (error) {
    <div class="error-container">
      <ion-text color="danger">
        <h3>‚ö†Ô∏è Connection Error</h3>
        <p>{{ error }}</p>
      </ion-text>
      <div class="error-actions">
        <ion-button fill="solid" color="primary" (click)="retryLoading()">
          <ion-icon name="refresh" slot="start"></ion-icon>
          Try Again
        </ion-button>
        <ion-button fill="outline" color="medium" (click)="goBack()">
          <ion-icon name="arrow-back" slot="start"></ion-icon>
          Go Back
        </ion-button>
      </div>
      <div class="connection-tips">
        <ion-text color="medium">
          <h4>üí° Troubleshooting Tips:</h4>
          <ul>
            <li>Check if you're connected to Wi-Fi or mobile data</li>
            <li>Try switching between Wi-Fi and mobile data</li>
            <li>Make sure you have a stable internet connection</li>
            <li>Close and reopen the app if the problem persists</li>
          </ul>
        </ion-text>
      </div>
    </div>
  }

  <!-- Chapter Content -->
  @else if (chapterData) {
    

    <div class="chapter-detail-container">
      <!-- Chapter Image -->
      <div class="chapter-image-section">
        <img [src]="chapterData.img" [alt]="chapterData.title" class="chapter-image" />
        <div class="chapter-overlay">
          <ion-text color="light">
            <h1 class="chapter-title">{{ chapterData.title }}</h1>
            <p class="chapter-number">Chapter {{ chapterData.category }}</p>
          </ion-text>
        </div>
      </div>

      <!-- Chapter Content -->
      <div class="chapter-content-section">
        <!-- Audio Section -->
        <app-audio-player
          [audioUrl]="chapterData.audioData.audioSrc"
          [audioTitle]="'Listen to ' + chapterData.title"
          [enableDownload]="true"
          [enableShare]="false"
          [enableSpeedControl]="true"
          [enableLoop]="true"
          (onDownload)="downloadAudio()">
        </app-audio-player>

        <!-- Custom Share Button with Rich Tamil Content -->
        <div class="chapter-share-section">
          <ion-button 
            expand="block" 
            fill="outline" 
            color="tertiary"
            class="share-chapter-button"
            (click)="shareChapterWithRichContent()">
            <ion-icon name="share" slot="start"></ion-icon>
            üôè Share this Chapter
          </ion-button>
        </div>

        <!-- Description Section -->
        <div class="description-section">
            <ion-text color="primary">
              <h3>üìñ Chapter Description</h3>
            </ion-text>
            <div class="description-content">
              <ion-text>
                <div [innerHTML]="chapterData.desc"></div>
              </ion-text>
            </div>
          </div>

          <!-- Chapter Info -->
          <div class="chapter-info-section">
            <ion-text color="primary">
              <h3>‚ÑπÔ∏è Chapter Information</h3>
            </ion-text>
            <div class="info-grid">
              <div class="info-item">
                <ion-text color="medium">
                  <strong>Chapter Number:</strong>
                </ion-text>
                <ion-text>
                  <p>{{ chapterData.category }}</p>
                </ion-text>
              </div>
              <div class="info-item">
                <ion-text color="medium">
                  <strong>Author:</strong>
                </ion-text>
                <ion-text>
                  <p>{{ chapterData.audioData.auther }}</p>
                </ion-text>
              </div>
              <div class="info-item">
                <ion-text color="medium">
                  <strong>Rating:</strong>
                </ion-text>
                <ion-text>
                  <p>‚≠ê {{ chapterData.rating }}/5</p>
                </ion-text>
              </div>
            </div>
          </div>

          <!-- Learning Instructions -->
          <div class="instructions-section">
            <ion-text color="primary">
              <h3>üìö Learning Guide</h3>
            </ion-text>
            <ion-text>
              <p>
                Listen to this chapter audio to understand the deeper meanings and context. 
                The Tamil narration will help you grasp the spiritual teachings of the Bhagavad Gita 
                in your native language.
              </p>
              <ul>
                <li>Listen to the full chapter audio</li>
                <li>Reflect on the teachings</li>
                <li>Practice memorization of key verses</li>
                <li>Apply the learnings in daily life</li>
              </ul>
            </ion-text>
          </div>

          <!-- Contact Details Section -->
          <div class="contact-section">
            <ion-text color="primary">
              <h3>üôè Need Help or Have Questions?</h3>
            </ion-text>
            <ion-text>
              <p>
                If you have any questions or doubts about this chapter, feel free to reach out to me. 
                I'm here to help you on your spiritual journey with the Bhagavad Gita.
              </p>
            </ion-text>
            
            <div class="contact-info">
              <div class="contact-item">
                <ion-icon name="person-circle" color="primary"></ion-icon>
                <div class="contact-details">
                  <strong>Narasimha Dasa</strong>
                  <p>Spiritual Guide & Teacher</p>
                </div>
              </div>
              
              <div class="contact-item">
                <ion-icon name="call" color="success"></ion-icon>
                <div class="contact-details">
                  <strong>Phone</strong>
                  <p><a href="tel:+916382043976">+91 6382043976</a></p>
                </div>
              </div>
              
              <div class="contact-item">
                <ion-icon name="logo-whatsapp" color="success"></ion-icon>
                <div class="contact-details">
                  <strong>WhatsApp</strong>
                  <p><a href="https://wa.me/916382043976?text=Hello%20Narasimha%20Dasa,%20I%20would%20like%20to%20receive%20daily%20Bhagavad%20Gita%20lessons" target="_blank" rel="noopener">+91 6382043976</a></p>
                  <small>Message for daily Bhagavad Gita lessons</small>
                </div>
              </div>
              
              <div class="contact-item">
                <ion-icon name="logo-youtube" color="danger"></ion-icon>
                <div class="contact-details">
                  <strong>YouTube Channel</strong>
                  <p><a href="https://www.youtube.com/@harekrishnatamilsamayal8959" target="_blank" rel="noopener">Hare Krishna (Tamil)</a></p>
                </div>
              </div>
              
              <div class="contact-item">
                <ion-icon name="globe" color="tertiary"></ion-icon>
                <div class="contact-details">
                  <strong>Website</strong>
                  <p><a href="https://askharekrishna.com" target="_blank" rel="noopener">askharekrishna.com</a></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    }


  </ion-content>
